# Stylelint Design Token Guard

[![NPM version][npm-image]][npm-url]
[![Downloads][downloads-image]][downloads-url]

`stylelint-design-token-guard` is a [Stylelint](https://stylelint.io/) plugin that helps enforce the use of predefined design system tokens (defined in a JSON file) instead of hardcoded values (e.g., `16px`, `#FFFFFF`) in your CSS, SCSS, Less, etc., files.

The plugin identifies values that can be replaced by tokens, reporting errors for exact matches and warnings for close matches.

## Key Features

*   **Token Enforcement**: Ensures visual consistency by enforcing token usage.
*   **Configurable Tokens**: Token definitions are loaded from an external JSON file, allowing easy adaptation to any design system.
*   **Autofix**: For exact token matches, Stylelint can automatically replace the hardcoded value with the corresponding token.
*   **Close Match Suggestions**: If there's no exact match, the plugin will suggest the closest available tokens (e.g., if you use `15px` and have a token for `16px`).
*   **Flexibility**: The user defines which CSS properties are checked for specific token categories (e.g., `spacing` tokens can apply to `margin`, `padding`, `gap`, etc.).

## Installation

Ensure you have Stylelint installed in your project. If not, install it:
```bash
npm install --save-dev stylelint
# or
yarn add --dev stylelint
```

Then, install the `stylelint-design-token-guard` plugin:
```bash
npm install --save-dev stylelint-design-token-guard
# or
yarn add --dev stylelint-design-token-guard
```

## Usage

1.  **Create a JSON file with your token definitions.**
    This file should contain an object where keys are token category names (e.g., `spacing`, `size`, `radius`). Each category should be an object with two fields:
    *   `properties`: An array of CSS property strings (lowercase) that the token category applies to.
    *   `tokens`: An object where the key is the hardcoded value (e.g., `"16px"`, `"0"`), and the value is its corresponding CSS token variable name (e.g., `"var(--size-1)"`, `"var(--spacing-0)"`).

    Example (`tokens.json`):
    ```json
    {
      "spacing": {
        "properties": [
          "gap", "row-gap", "column-gap",
          "margin", "margin-top", "margin-right", "margin-bottom", "margin-left",
          "padding", "padding-top", "padding-right", "padding-bottom", "padding-left"
        ],
        "tokens": {
          "2px": "var(--spacing-micro)",
          "4px": "var(--spacing-xxs)",
          "8px": "var(--spacing-xs)",
          "12px": "var(--spacing-sm)",
          "16px": "var(--spacing-md)",
          "24px": "var(--spacing-lg)",
          "32px": "var(--spacing-xl)",
          "0": "var(--spacing-none)"
        }
      },
      "radius": {
        "properties": [
          "border-radius",
          "border-top-left-radius", "border-top-right-radius",
          "border-bottom-left-radius", "border-bottom-right-radius"
        ],
        "tokens": {
          "4px": "var(--radius-small)",
          "8px": "var(--radius-medium)",
          "100%": "var(--radius-circle)"
        }
      }
    }
    ```

2.  **Configure Stylelint.**
    Add `stylelint-design-token-guard` to the `plugins` array in your Stylelint configuration (e.g., `.stylelintrc.json`, `stylelint.config.js`). Then, in the `rules` section, enable and configure the `design-token-guard/enforce-tokens` rule.

    Example configuration (`.stylelintrc.json`):
    ```json
    {
      "plugins": [
        "stylelint-design-token-guard"
      ],
      "rules": {
        "design-token-guard/enforce-tokens": [
          true, // Enables the rule
          {
            // Required: Path to your JSON file with token definitions.
            // Can be an absolute path or relative to the project root.
            "tokensFilePath": "./config/design-tokens.json",

            // Optional: Tolerance margin for close matches (numeric values for px).
            // Default: 2 (e.g., if you have a token for 16px, a value of 14px or 18px will be suggested).
            // Set to 0 to disable close match suggestions.
            "tokenMatchMargin": 2
          }
        ]
      }
    }
    ```

## Error and Warning Messages

*   **Error - Exact Match**:
    `Design token <token_name> expected for property <property_name>: <original_value>`
    This error indicates that an exact token exists for the used value. It can be automatically fixed by Stylelint via the `--fix` CLI option. This message is generated by the `design-token-guard/enforce-tokens` rule.

*   **Warning - Close Match**:
    `Consider token: <token_name> ('<token_px_value>') for current value "<original_px_value>". Other close matches: <other_suggestions>.`
    This warning appears when there is no exact match, but tokens for numeric (px) values close to the used value were found. It is not autofixed. This message is generated by the `design-token-guard/enforce-tokens` rule.

## How It Works

The plugin analyzes CSS declarations. For each property, it checks if it belongs to a category defined in your `tokens.json` file. If so, the property's value is compared against the tokens in that category:
1.  If the value exactly matches a key in `tokens`, an error is reported with autofix capability.
2.  If the value is a `px` value and there's no exact match, but `px` tokens exist within the `tokenMatchMargin`, a warning with suggestions is reported.

## Tips

*   Keep your `tokens.json` file updated according to your design system.
*   Regularly run Stylelint with the `--fix` option to automatically correct fixable violations.
*   Integrate Stylelint into your CI/CD process to ensure code consistency.

## Contributing

If you have ideas for improvements or have found a bug, feel free to open issues or pull requests on the [GitHub project page](https://github.com/YOUR_USERNAME/stylelint-design-token-guard). (Remember to update this link!)

## License

[MIT](LICENSE)

[npm-image]: https://img.shields.io/npm/v/stylelint-design-token-guard.svg
[npm-url]: https://npmjs.org/package/stylelint-design-token-guard
[downloads-image]: https://img.shields.io/npm/dm/stylelint-design-token-guard.svg
[downloads-url]: https://npmjs.org/package/stylelint-design-token-guard 